# Shared observability stack for devops-ai sandboxes.
#
# All host ports use the 4xxxx range to avoid conflicts with ktrdr's
# standard (8xxx) and offset (8xxx+100*N) ports.
#
# Sandboxes connect via the devops-ai-observability Docker network
# (created externally by kinfra).

services:
  devops-ai-jaeger:
    image: jaegertracing/jaeger:latest
    container_name: devops-ai-jaeger
    restart: unless-stopped
    environment:
      COLLECTOR_OTLP_ENABLED: "true"
    ports:
      - "127.0.0.1:44317:4317"   # OTLP gRPC receiver
      - "127.0.0.1:46686:16686"  # Jaeger UI
    networks:
      - devops-ai-observability

  devops-ai-grafana:
    image: grafana/grafana:latest
    container_name: devops-ai-grafana
    restart: unless-stopped
    environment:
      GF_AUTH_ANONYMOUS_ENABLED: "true"
      GF_AUTH_ANONYMOUS_ORG_ROLE: Admin
    ports:
      - "127.0.0.1:43000:3000"  # Grafana UI
    networks:
      - devops-ai-observability

  devops-ai-prometheus:
    image: prom/prometheus:latest
    container_name: devops-ai-prometheus
    restart: unless-stopped
    ports:
      - "127.0.0.1:49090:9090"  # Prometheus HTTP
    networks:
      - devops-ai-observability

networks:
  devops-ai-observability:
    external: true
